<button
  class="copy-button absolute right-2 top-2 rounded-md p-2 text-gray-400 opacity-0 transition-opacity hover:text-gray-200 group-hover:opacity-100 bg-black/30 border border-white/10"
  aria-label="Copy code"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="copy-icon"
  >
    <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
    <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
  </svg>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width="24"
    height="24"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="check-icon hidden"
  >
    <polyline points="20 6 9 17 4 12"></polyline>
  </svg>
</button>

<script>
  document.addEventListener("astro:page-load", () => {
    document.querySelectorAll(".copy-button").forEach((button) => {
      button.addEventListener("click", async () => {
        const pre = button.closest("div").querySelector("pre");
        const code = pre.textContent;

        try {
          await navigator.clipboard.writeText(code);

          // Show success state
          const copyIcon = button.querySelector(".copy-icon");
          const checkIcon = button.querySelector(".check-icon");

          copyIcon.classList.add("hidden");
          checkIcon.classList.remove("hidden");

          // Reset after 2 seconds
          setTimeout(() => {
            copyIcon.classList.remove("hidden");
            checkIcon.classList.add("hidden");
          }, 2000);
        } catch (err) {
          console.error("Failed to copy:", err);
        }
      });
    });
  });
</script>

<style>
  .copy-button {
    background-color: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .copy-button:hover {
    background-color: rgba(0, 0, 0, 0.4);
  }

  .copy-button:active {
    background-color: rgba(0, 0, 0, 0.5);
  }

  .hidden {
    display: none;
  }
</style>

