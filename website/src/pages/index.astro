---
import Layout from "../layouts/Layout.astro";
import aiContextRaw from "../data/ai-context.txt?raw";
const aiContext = aiContextRaw.trim();
const heroCode = `import { defineServe } from '@hypequery/serve';
import { z } from 'zod';
import { db } from './analytics/client';

export const api = defineServe({
  context: () => ({ db }),
  queries: {
    weeklyRevenue: {
      inputSchema: z.object({ startDate: z.string() }),
      query: async ({ ctx, input }) =>
        ctx.db
          .table('orders')
          .where('created_at', 'gte', input.startDate)
          .groupBy(['week'])
          .sum('total', 'revenue')
    },
  },
});

const revenue = await api.execute('weeklyRevenue', {
  input: { startDate: '2025-01-01' }
});`;
---

<Layout title="hypequery - TypeScript SDK for ClickHouse with Type Safety">
  <main>
    <!-- Hero section -->
    <div class="relative isolate pt-14">
      <div class="py-24 sm:py-32">
        <div class="mx-auto max-w-7xl px-4 lg:px-6">
          <div
            class="flex flex-col items-start md:flex-row md:items-end relative"
          >
            <div class="max-w-3xl pb-12">
              <h1
                class="text-4xl font-bold tracking-tight text-gray-900 sm:text-6xl animate-on-scroll"
              >
                The code-first analytics layer for ClickHouse
              </h1>
              <div>
                <p
                  class="mt-6 text-lg leading-8 text-gray-600 animate-on-scroll"
                >
                  Define type safe queries and metrics in TypeScript.
                </p>
                <p class="text-lg leading-8 text-gray-600 animate-on-scroll">
                  Reuse them across services, dashboards, and AI agents.
                </p>
              </div>
              <div class="mt-8 space-y-3 animate-on-scroll">
                <div class="flex flex-wrap items-center gap-4">
                  <a
                    href="/docs"
                    class="rounded-md bg-indigo-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
                  >
                    Quickstart &rarr;
                  </a>
                </div>
                <div class="flex flex-wrap items-center gap-4">
                  <a
                    href="https://github.com/hypequery/hypequery"
                    class="inline-flex items-center gap-2 rounded-md border border-gray-300 px-4 py-2.5 text-sm font-semibold text-gray-700 shadow-sm transition hover:bg-gray-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-white/10"
                    target="_blank"
                    rel="noreferrer"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4"
                      fill="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
                      ></path>
                    </svg>
                    on GitHub
                  </a>
                  <button
                    type="button"
                    class="relative rounded-md border border-indigo-600 px-4 py-2.5 text-sm font-semibold text-indigo-600 shadow-sm transition hover:bg-indigo-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:border-indigo-400/70 dark:text-indigo-200 dark:hover:bg-indigo-500/20"
                    data-copy-target="ai-context-snippet"
                  >
                    <span data-copy-default class="flex items-center gap-2">
                      Copy AI context
                    </span>
                    <span
                      data-copy-success
                      class="pointer-events-none absolute inset-0 flex items-center justify-center gap-2 rounded-md bg-emerald-500/10 text-emerald-600 opacity-0 transition-opacity"
                    >
                      Copied
                    </span>
                  </button>
                  <a
                    href="/cursor-rules.md"
                    download
                    class="rounded-md border border-gray-300 px-4 py-2.5 text-sm font-semibold text-gray-700 shadow-sm transition hover:bg-gray-50 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-white/10"
                  >
                    Download cursor-rules.md
                  </a>
                </div>
              </div>
              <textarea
                id="ai-context-snippet"
                class="sr-only"
                aria-hidden="true"
                readonly>{aiContext}</textarea
              >
              <p
                class="mt-3 text-sm font-medium uppercase tracking-wide text-gray-500 animate-on-scroll"
              >
                No YAML &middot; No SQL strings &middot; No duplicated metrics
              </p>
            </div>
            <div class="animate-on-scroll md:-ml-40">
              <img
                src="/mascot.png"
                alt="hypequery mascot"
                class="hero-mascot hero-mascot-light h-64 w-auto rounded-2xl object-contain"
              />
              <img
                src="/mascot_dark.jpeg"
                alt="hypequery mascot"
                class="hero-mascot hero-mascot-dark h-64 w-auto rounded-2xl object-contain"
              />
            </div>
            <div
              class="absolute right-0 top-0 -translate-y-1/4 animate-on-scroll"
              data-hero-terminal
            >
              <div
                class="relative w-[420px] rounded-2xl border border-gray-800 bg-gray-950 px-5 py-4 text-sm text-green-300 shadow-2xl"
                data-hero-terminal-shell
              >
                <div class="flex items-center justify-between gap-3 font-mono">
                  <span>
                    <span class="text-gray-500">$</span>
                    <span data-terminal-command>npx hypequery init</span>
                  </span>
                  <button
                    type="button"
                    class="relative inline-flex min-w-[96px] items-center justify-center rounded-md border border-white/20 bg-white/10 px-2 py-1 text-xs font-semibold text-gray-100 transition hover:bg-white/20"
                    data-copy-snippet="npx hypequery init"
                    aria-label="Copy npx hypequery init"
                  >
                    <span
                      class="flex items-center gap-1 transition-opacity duration-200"
                      data-copy-default
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-3.5 w-3.5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"
                        ></rect>
                        <path
                          d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
                        ></path>
                      </svg>
                      Copy
                    </span>
                    <span
                      aria-hidden="true"
                      class="pointer-events-none absolute inset-0 flex items-center justify-center gap-1 rounded-md bg-emerald-500/10 text-emerald-200 opacity-0 transition-opacity duration-200"
                      data-copy-success
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-3.5 w-3.5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                      Copied
                    </span>
                  </button>
                </div>
                <div
                  class="mt-3 min-h-[110px] space-y-1 font-mono text-xs text-emerald-200/80"
                  data-terminal-log
                >
                  <p>Waiting for command...</p>
                </div>
              </div>
            </div>
          </div>

          <section
            class="mt-12 rounded-2xl py-8 text-gray-900 animate-on-scroll"
          >
            <p
              class="text-sm font-semibold uppercase tracking-wide text-indigo-500"
            >
              Analytics that behaves like code
            </p>
            <h2 class="mt-2 text-3xl font-bold tracking-tight">
              Metrics defined like software, not config
            </h2>
            <div class="mt-6 space-y-4 text-base leading-7 text-gray-600">
              <p>
                You define named queries and metrics in TypeScript, give them
                schemas and metadata, and execute them wherever you need —
                embedded in your app, exposed via APIs, or consumed by agents.
              </p>
            </div>
            <div class="mt-8 rounded-xl bg-gray-950 p-1 text-sm">
              <div class="flex gap-2 p-2">
                <span class="size-3 rounded-full bg-white/20"></span>
                <span class="size-3 rounded-full bg-white/20"></span>
                <span class="size-3 rounded-full bg-white/20"></span>
              </div>
              <pre
                class="rounded-lg border border-white/10 bg-white/5 text-left text-sm leading-6 text-emerald-100">
                <code class="language-typescript">{heroCode}</code>
              </pre>
            </div>
          </section>

          <section class="mt-24">
            <h2
              class="text-3xl font-bold tracking-tight text-gray-900 animate-on-scroll"
            >
              What teams use hypequery for
            </h2>
            <div
              class="mt-10 grid gap-4 md:grid-cols-2 lg:grid-cols-4 animate-on-scroll"
              data-use-case-grid
            >
              <button
                type="button"
                class="use-case-card border border-gray-200 rounded-2xl p-6 bg-white text-left shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 transition"
                data-use-case-card
                data-title="Backend & platform teams"
                data-body="Keep analytics definitions next to application logic. Import the same metric into cron jobs, background workers, or API handlers without rewriting SQL."
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Backend & platform teams
                </h3>
                <p class="mt-4 text-sm text-gray-600">
                  Stop copying SQL between services. Define analytics once and
                  reuse them across jobs, APIs, and internal tools.
                </p>
              </button>
              <button
                type="button"
                class="use-case-card border border-gray-200 rounded-2xl p-6 bg-white text-left shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 transition"
                data-use-case-card
                data-title="Internal dashboards"
                data-body="Expose a curated API backed by hypequery definitions. Each dashboard call hits a named query so changes propagate everywhere instantly."
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Internal dashboards
                </h3>
                <p class="mt-4 text-sm text-gray-600">
                  Expose a small, trusted set of metrics instead of letting
                  every dashboard redefine business logic.
                </p>
              </button>
              <button
                type="button"
                class="use-case-card border border-gray-200 rounded-2xl p-6 bg-white text-left shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 transition"
                data-use-case-card
                data-title="AI agents & automation"
                data-body="Agents list available queries, inspect the schema, and execute them safely. Typed input/output keeps LLM prompts honest."
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  AI agents & automation
                </h3>
                <p class="mt-4 text-sm text-gray-600">
                  Give agents structured, discoverable analytics with typed
                  inputs and outputs — not raw SQL strings.
                </p>
              </button>
              <button
                type="button"
                class="use-case-card border border-gray-200 rounded-2xl p-6 bg-white text-left shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500 transition"
                data-use-case-card
                data-title="Data teams on ClickHouse"
                data-body="Layer governance on top of ClickHouse without slowing it down. Define the metric once, let BI, ops, and product share the exact same logic."
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Data teams on ClickHouse
                </h3>
                <p class="mt-4 text-sm text-gray-600">
                  Keep ClickHouse fast and flexible without pushing business
                  logic into dashboards or BI tools.
                </p>
              </button>
            </div>
            <div
              class="mt-10 rounded-3xl bg-white p-4 shadow-lg ring-2 ring-indigo-100 animate-on-scroll"
              data-use-case-example
            >
              <div class="rounded-2xl bg-gray-950 p-1 text-sm">
                <div class="flex gap-2 p-2">
                  <span class="size-3 rounded-full bg-white/20"></span>
                  <span class="size-3 rounded-full bg-white/20"></span>
                  <span class="size-3 rounded-full bg-white/20"></span>
                </div>
                <div
                  class="rounded-xl bg-white p-6 text-gray-900 dark:bg-gray-900 dark:text-gray-100"
                >
                  <span
                    class="inline-flex items-center gap-1 rounded-full bg-indigo-50 px-3 py-1 text-[11px] font-semibold uppercase tracking-wide text-indigo-700 dark:bg-indigo-400/10 dark:text-indigo-200"
                    data-use-case-pill
                  >
                  </span>
                  <p
                    class="text-xs font-semibold uppercase tracking-wide text-indigo-500 dark:text-indigo-300"
                  >
                    Example
                  </p>
                  <h3
                    class="mt-3 text-2xl font-bold tracking-tight"
                    data-use-case-title
                  >
                  </h3>
                  <p
                    class="mt-4 text-base leading-7 text-gray-600 dark:text-gray-300"
                    data-use-case-body
                  >
                  </p>
                </div>
              </div>
            </div>
          </section>

          <section class="mt-24 animate-on-scroll">
            <div
              class="relative left-1/2 right-1/2 w-screen -translate-x-1/2 bg-gray-100 py-16 dark:bg-slate-800"
            >
              <div class="mx-auto max-w-7xl px-4 lg:px-6">
                <div
                  class="grid gap-10 lg:grid-cols-[1.1fr_auto] lg:items-center"
                >
                  <div>
                    <h2 class="text-3xl font-bold tracking-tight text-gray-900">
                      Why not just write SQL everywhere?
                    </h2>
                    <p class="mt-6 text-lg leading-7 text-gray-700">
                      That works — at first.
                    </p>
                    <div
                      class="mt-6 space-y-3 text-base leading-7 text-gray-700"
                    >
                      <p>Then metrics drift.</p>
                      <p>Logic gets copied.</p>
                      <p>And “the correct query” becomes a debate.</p>
                    </div>
                    <div
                      class="mt-8 space-y-3 text-base leading-7 text-gray-700"
                    >
                      <p>
                        hypequery exists to make one thing unambiguous:
                        <strong class="text-gray-900"
                          >where metrics live.</strong
                        >
                      </p>
                      <p class="text-xl font-bold text-gray-900">
                        In code. Once.
                      </p>
                    </div>
                  </div>
                  <div class="flex justify-center">
                    <img
                      src="/confused_mascot.png"
                      alt="Confused mascot wondering about SQL"
                      class="h-72 w-auto rounded-3xl object-contain"
                    />
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="mt-24 animate-on-scroll">
            <h2 class="text-3xl font-bold tracking-tight text-gray-900">
              A set of opt-in primitives for modern analytics
            </h2>
            <div class="mt-10 grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              <div
                class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Type-safe query building
                </h3>
                <p class="mt-4 text-sm leading-6 text-gray-600">
                  Define analytics logic in TypeScript with schemas, metadata,
                  and ownership — not string SQL.
                </p>
              </div>
              <div
                class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Embedded-first execution
                </h3>
                <p class="mt-4 text-sm leading-6 text-gray-600">
                  Run queries directly in-process (api.run) for SSR, background
                  jobs, and AI agents — no server required.
                </p>
              </div>
              <div
                class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Reusable metrics & queries
                </h3>
                <p class="mt-4 text-sm leading-6 text-gray-600">
                  Define once. Reuse across services, dashboards, and automation
                  without duplication.
                </p>
              </div>
              <div
                class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Optional HTTP & APIs
                </h3>
                <p class="mt-4 text-sm leading-6 text-gray-600">
                  Expose metrics via HTTP when needed and ship OpenAPI specs
                  automatically.
                </p>
              </div>
              <div
                class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Multi-tenant ready
                </h3>
                <p class="mt-4 text-sm leading-6 text-gray-600">
                  Auto-inject tenant filters, enforce isolation, and reuse the
                  same metric definitions across every customer safely.
                </p>
              </div>
              <div
                class="rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"
              >
                <h3 class="text-lg font-semibold text-gray-900">
                  Optional caching
                </h3>
                <p class="mt-4 text-sm leading-6 text-gray-600">
                  Cache at the query level, where it actually belongs.
                </p>
              </div>
            </div>
          </section>

          <section
            class="mt-20 rounded-3xl bg-gray-900 p-10 text-gray-100 animate-on-scroll"
          >
            <h2 class="text-3xl font-bold tracking-tight">
              Humans first. Agents included. Hyenas? Not so much.
            </h2>
            <p class="mt-6 text-lg text-gray-200">
              Your analytics aren’t blobs of SQL. They’re:
            </p>
            <div class="mt-6 grid gap-8 md:grid-cols-2">
              <div>
                <ul class="space-y-1 text-base text-gray-100">
                  <li>Named</li>
                  <li>Typed</li>
                  <li>Documented</li>
                  <li>Discoverable</li>
                </ul>
              </div>
              <div>
                <p
                  class="text-sm font-semibold uppercase tracking-wide text-indigo-300"
                >
                  Which means they work for:
                </p>
                <ul class="mt-4 space-y-2 text-base text-gray-100">
                  <li>Humans reading code</li>
                  <li>Frontends calling APIs</li>
                  <li>AI agents doing real work</li>
                </ul>
              </div>
            </div>
            <div class="mt-8 space-y-2 text-sm text-gray-300">
              <p>No prompt hacks.</p>
              <p>No agent-specific APIs.</p>
              <p class="text-base font-semibold text-white">Just structure.</p>
            </div>
          </section>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script is:inline>
  const initUseCaseSwitcher = () => {
    const cards = Array.from(document.querySelectorAll("[data-use-case-card]"));
    const titleEl = document.querySelector("[data-use-case-title]");
    const bodyEl = document.querySelector("[data-use-case-body]");
    const pillEl = document.querySelector("[data-use-case-pill]");
    if (!cards.length || !titleEl || !bodyEl) return;

    let activeCard = null;

    const selectCard = (card) => {
      if (!card) return;
      activeCard = card;
      cards.forEach((btn) => {
        const isActive = btn === card;
        btn.classList.toggle("bg-indigo-50", isActive);
        btn.classList.toggle("border-indigo-300", isActive);
        btn.classList.toggle("border-gray-200", !isActive);
        btn.classList.toggle("ring-2", isActive);
        btn.classList.toggle("ring-indigo-200", isActive);
        btn.classList.toggle("ring-offset-2", isActive);
        btn.classList.toggle("ring-offset-white", isActive);
        btn.classList.toggle("shadow-lg", isActive);
        btn.classList.toggle("shadow-sm", !isActive);
        btn.classList.toggle("opacity-60", !isActive);
        btn.classList.toggle("opacity-100", isActive);
        btn.setAttribute("aria-pressed", isActive ? "true" : "false");
      });
      const title = card.dataset.title || "";
      titleEl.textContent = title;
      bodyEl.textContent = card.dataset.body || "";
      if (pillEl) {
        pillEl.textContent = title ? `Now showing • ${title}` : "";
      }
    };

    cards.forEach((card) => {
      card.addEventListener("click", () => selectCard(card));
    });

    selectCard(cards[0]);
  };

  const initHeroTerminal = () => {
    const area = document.querySelector("[data-hero-terminal]");
    if (!area) return;
    const shell = area.querySelector("[data-hero-terminal-shell]");
    const commandEl = area.querySelector("[data-terminal-command]");
    const logEl = area.querySelector("[data-terminal-log]");
    if (!shell || !commandEl || !logEl) return;

    const sequences = [
      {
        command: "npx hypequery init",
        lines: [
          "Scaffolding project...",
          "Creating ClickHouse types...",
          "Linking metrics to code...",
          "Done in 1.8s",
        ],
      },
      {
        command: "npx hypequery generate",
        lines: [
          "Reading ClickHouse schema...",
          "Mapping columns → TypeScript...",
          "Writing analytics/schema.ts",
          "Types refreshed.",
        ],
      },
      {
        command: "npx hypequery dev",
        lines: [
          "Booting local runner...",
          "Watching metrics for edits...",
          "Exposing API on http://localhost:8787",
          "Ready for requests.",
        ],
      },
    ];

    let timers = [];
    let sequenceIndex = 0;
    let running = false;

    const clearTimers = () => {
      timers.forEach((id) => clearTimeout(id));
      timers = [];
    };

    const resetLog = () => {
      logEl.innerHTML =
        '<p class="text-xs font-mono text-emerald-200/70">Waiting for command...</p>';
      commandEl.textContent = "npx hypequery init";
    };

    const playSequence = () => {
      const current = sequences[sequenceIndex % sequences.length];
      sequenceIndex += 1;
      commandEl.textContent = current.command;
      logEl.innerHTML = "";
      current.lines.forEach((line, idx) => {
        const timer = window.setTimeout(() => {
          const lineEl = document.createElement("p");
          lineEl.textContent = line;
          lineEl.className = "text-xs font-mono text-emerald-100/90";
          logEl.appendChild(lineEl);
        }, idx * 700);
        timers.push(timer);
      });

      const total = current.lines.length * 700 + 800;
      const loopTimer = window.setTimeout(() => {
        if (!running) return;
        playSequence();
      }, total);
      timers.push(loopTimer);
    };

    const start = () => {
      if (running) return;
      running = true;
      area.classList.add("terminal-active");
      playSequence();
    };

    const stop = () => {
      running = false;
      area.classList.remove("terminal-active");
      clearTimers();
      resetLog();
    };

    resetLog();
    area.addEventListener("mouseenter", start);
    area.addEventListener("mouseleave", stop);
    area.addEventListener("focusin", start);
    area.addEventListener("focusout", stop);
    area.addEventListener("touchstart", start, { passive: true });
    area.addEventListener("touchend", stop);
  };

  const initPageInteractions = () => {
    initUseCaseSwitcher();
    initHeroTerminal();
  };

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initPageInteractions);
  } else {
    initPageInteractions();
  }
</script>

<style>
  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0;
    }
  }

  .animate-blink {
    animation: blink 1s step-end infinite;
  }

  [data-hero-terminal] {
    transition: none;
  }
</style>
